var editor={};(function(){var ag=jQuery;var P="pecT",I=ag("#editor-nb"),J="online",aj=ag("#jsonText").keyup(function(){aa("keyup")}).click(function(){aa("click")}),R=ag("#iX"),T=ag("#hW"),X=ag("#lA"),Z=ag("#kZ"),ae=R.add(X),O="/",ad=aj.hasClass("posted"),ah=P.search(/e/)!=-1,ac="fr",V=100,ai="parser",K=ag("html"),W=ag(window),S=".",ab=ag("#favicon"),u=ag("#footer"),U="json",l="object",Y="array",Q="string",L="number",af="boolean",H="http:"+O+O+U+S+ai+S+J+S+ac+O;ag(".P").delegate(".toggle","click",function(){var a=ag(this).parent();if(a.length==0){a=ag(this).closest(".P")}a.toggleClass("collapsed");return false});function N(a){function b(e){function d(h){if(h===null){return"null"}if(typeof(h)==="object"&&h.length){return"array"}return typeof h}function f(n,k,h){var m="",i,j;for(j in n){if(n.hasOwnProperty(j)){if(m!==""){m+=h}i=n[j];if(i===undefined){i=null}if(k!=="array"){m+='<span class="property">';m+=(k==="object")?'"<span class="p">'+j+'</span>"</span>:':'<span class="p">'+j+"</span></span>:"}m+=b(i)}}return m}var g="",c=d(e);switch(c){case"object":g='<span class="'+c+'"><span class="toggle">{</span><ul><li>'+f(e,c,",</li><li>")+'</li></ul><span class="toggle-end">}</span></span>';break;case"array":g='<span class="'+c+'"><span class="toggle">[</span><ol><li>'+f(e,c,",</li><li>")+'</li></ol><span class="toggle-end" card="'+e.length+'">]</span></span>';break;case"null":g='<span class="'+c+'">'+c+"</span>";break;case"string":g='<span class="'+c+'">"'+e+'"</span>';break;default:g='<span class="'+c+'">'+e+"</span>";break}return g}return b(a)}function M(e){function k(n){return c(j(n))}function j(n){return n.replace(/\s+$/g,"")}function c(n){return n.replace(/^\s+/g,"")}function i(){var n=0,o,p;do{n=f.indexOf('"',n+1),o=0,p=1;do{if(f.substring(n-p,n-p+1)==="\\"){o=o+1;p++;continue}break}while(true);if(o%2===0){break}}while(true);return n}function h(n){function o(r){function q(s){var w,v,x,t=s.substring(0,1);s.update("");if(t==='"'){w=s.shift(i(s.todo)+1);if(w.search(/\\u(?![\d|A-F|a-f]{4})/g)!==-1){return s.err("\\u must be followed by 4 hexadecimal characters",w)}length=w.length;for(x=0;x<length;x++){if(w.substring(x,x+1)=="\\"){if(x+1<length){x++;if(!w.substring(x,x+1).search(/[^\"|\\|\/|b|f|n|r|t|u]/)){return s.err("Backslash must be escaped",w)}}}}return s.update('<span class="property">"<span class="p">'+w.substring(1,w.length-1)+'</span>"</span>')}w=s.shift(s.indexOf(":"));return s.err("Name property must be a String wrapped in double quotes.",w)}function p(s){if(s.substring(0,1)!==":"){s.err("Semi-column is missing.",s.shift(s.indexOf(":")))}return s.swap(1)}r.update("<li>");if(r.substring(0,1)==="}"){return r.update("</li>")}r=q(r);r=p(r);r=g(r,"}");if(r.substring(0,1)===","){r.swap(1).update("</li>");return o(r)}if(r.substring(0,1)==="}"){return r.update("</li>")}return r.err("Comma is missing",r.shift(r.indexOf("}"))).update("</li>")}if(n.indexOf("{")===-1){n.err("Opening brace is missing",n.todo);return n.update("","")}else{n.shift(1);n.update('<span class="object"><span class="toggle">{</span><ul>');n=o(n).update("</ul>");if(n.indexOf("}")===-1){n.err("Closing brace is missing",n.todo);return n.update("","")}return n.span("toggle-end",n.shift(1))}}function m(o){var n=0;function p(r,q){r.update("<li>");r=g(r,"]");if(r.substring(0,1)===","){r.swap(1).update("</li>");return p(r,++n)}if(r.substring(0,1)==="]"){return r.update("</li>")}return r.err("Comma is missing",r.shift(r.search(/(,|\])/))).update("</li>")}if(o.indexOf("[")===-1){o.err("Opening square bracket is missing",o.todo);return o.update("","")}o.shift(1);o.update('<span class="array">');o.update('<span class="toggle">[</span><ol>');if(o.indexOf("]")===0){o.shift(1);o.update('</ol><span class="toggle-end" card="0">]</span>');return o.update("</span>")}o=p(o,0);if(o.indexOf("]")===-1){o.err("Closing square bracket is missing",o.todo);o.update('</ol><span class="toggle-end" card="'+(n+1)+'"></span>');return o.update("</span>")}o.shift(1);o.update('</ol><span class="toggle-end" card="'+(n+1)+'">]</span>');return o.update("</span>")}function g(o,t){var w,q,s,v,r,n="";if(o.search(/^(")/)===0){w=o.shift(i(o.todo)+1);if(w.search(/\\u(?![\d|A-F|a-f]{4})/g)!==-1){return o.err("\\u must be followed by 4 hexadecimal characters",w)}v=w.length;for(s=0;s<v;s++){if(w.substring(s,s+1)=="\\"){if(s+1<v){s++;if(!w.substring(s,s+1).search(/[^\"|\\|\/|b|f|n|r|t|u]/)){return o.err("Backslash must be escaped",w)}}}}return o.span("string",w)}if(o.search(/^\{/)===0){return h(o)}if(o.search(/^\[/)===0){return m(o)}q=o.search(new RegExp("(,|"+t+")"));if(q===-1){q=o.todo.length-1;r=j(o.todo);o.update("","")}else{r=j(o.shift(q))}try{n=typeof ag.parseJSON(r)}catch(p){}switch(n){case"boolean":case"number":return o.span(n,r);default:if(r==="null"){return o.span("null",r)}else{if(r.search(/^(')/)===0){return o.err("String must be wrapped in double quotes",r)}return o.err("Unknown type",r)
}}}var d=false,b=function(n){this.done="";this.todo=n?n:"";this.update=function(o,p){if(o){this.done+=o}if(p!==undefined){this.todo=c(p)}return this};this.swap=function(o){if(o&&!isNaN(Number(o))&&this.todo.length>=o){this.update(this.todo.substr(0,o),this.todo.substring(o))}return this};this.toString=function(){if(this.todo.length!==0){this.err("Text after last closing brace.",this.todo)}return this.done};this.span=function(p,o){return this.update('<span class="'+p+'">'+o+"</span>")};this.err=function(o,p){d=true;return this.update('<span class="error" title="'+o+'">'+p+"</span>")};this.shift=function(p){var o;if(p&&!isNaN(Number(p))&&this.todo.length>=p){o=this.substring(0,p);this.update("",this.substring(p));return j(o)}return""};this.indexOf=function(o,p){if(p){return this.todo.indexOf(o,p)}else{return this.todo.indexOf(o)}};this.substring=function(p,o){if(o){return this.todo.substring(p,o)}else{return this.todo.substring(p)}};this.search=function(o){return this.todo.search(o)}},f=new b(k(e)),a;if(c(e).substr(0,1)==="["){a={html:m(f).toString(),valid:!d}}else{if(c(e).substr(0,1)==="{"){a={html:h(f).toString(),valid:!d}}else{a={html:f.err("JSON expression must be an object or an array",e).update(null,"").toString(),valid:false}}}return a}function aa(b){var a=aj.val(),c='<link rel="icon" type="image/png" href="/favicon',d='.png" id="favicon"/>';if(ag.trim(a)===""){R.html("");X.html("");ab.after(c+d).remove();I.addClass("json-empty").removeClass("json-error");T.html("String is empty");Z.html("&nbsp;");return}I.removeClass("json-empty json-error");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");setTimeout(function(){var g=M(a),f=ag(g.html,document),e;f.find(".p").each(function(){if(ag(this).closest("li").find("li").length!==0){ag(this).addClass("collapsible")}});R.html(f);if(g.valid){ab.after(c+d).remove();T.html("String parse")}else{ab.after(c+"ko"+d).remove();e=g.html.match(/class="error"/g).length;T.html("String parse:&nbsp;<b>"+e+"&nbsp;error"+(e>1?"s":"")+"</b>");I.addClass("json-error")}W.resize()},0)}if(H.length!==29){ag=null;return}aa();editor.updateParse=aa;editor.textarea=$("#editor-nb #split textarea");editor.setContent=function(a){this.textarea.val(a);this.updateParse("click")};editor.getContent=function(){return this.textarea.val()}})();